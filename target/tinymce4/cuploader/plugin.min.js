tinymce.PluginManager.add("cuploader", function(e) {
	
	var openCuploader = function(){
		// cuploader url
		var cuploaderUrl = './root/';
		if("cuploader_url" in e.settings)
			cuploaderUrl = e.settings.cuploader_url;
		// language
		var currentLanguage = 'en';
		if("language" in e.settings)
			currentLanguage = e.settings.language;

		if(!("cuploaderSettings" in e.settings))
			e.settings.cuploaderSettings = {
				path: '',
				type: ''
			};
		cuploaderUrl +='manage.php/index/?target=tinymce4&lang='+currentLanguage;
		if(e.settings.cuploaderSettings.path != '')
			cuploaderUrl += '&path='+e.settings.cuploaderSettings.path;
		if(e.settings.cuploaderSettings.type != '')
			cuploaderUrl += '&type='+e.settings.cuploaderSettings.type;
		
		e.windowManager.open({title: "Cuploader", url: cuploaderUrl, width: 900, height: 600})
	};
	
	e.addButton("cuploader", {image: tinymce.baseURL+'/plugins/cuploader/archive.png', onclick: function() {
			
			openCuploader();
		}}), 
	e.addMenuItem("cuploader", {text: "Cuploader", context: "tools", onclick: function() {
			openCuploader();
		}})
});